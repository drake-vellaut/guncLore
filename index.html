---
layout: default
title: "Stars Reach - GUNC Lore"
pagination:
  enabled: true
  per_page: 5
  collection: posts  # Add this line
---

<!-- Header -->
<header>
  <h1>GUNC Lore</h1>
  <p>Stars Reach MMORPG - GUNC Lore</p>
</header>

<!-- Navigation Bar -->
<nav>
  <a href="https://gunc.org">GUNC Homepage</a>
  <a href="{{ '/' | relative_url }}">GUNC Lore</a>
  <a href="/search.html">Search</a>
</nav>

<!-- Search Bar -->
   <form id="search-form" style="margin-bottom: 2rem;">
     <input type="text" id="search-input" placeholder="Search lore..." style="width: 70%; padding: 0.5rem;">
     <button type="submit" style="padding: 0.5rem;">Search</button>
   </form>

   <!-- Default Post List (will be replaced by search results) -->
   <div id="post-list">
    <!-- Sidebar: All Tags Sorted by Count -->
<!-- Sidebar: All Tags Sorted by Count -->
<aside class="sidebar" style="float: right; width: 20%; margin-left: 2rem;">
  <h3>All Tags</h3>
  <ul>
  {% capture temp_tags %}
    {% for tag in site.tags %}
      {{ tag[1].size | prepend: '000' | slice: -3,3 }}#{{ tag[0] }}~
    {% endfor %}
  {% endcapture %}
  {% assign sorted_temp_tags = temp_tags | split:'~' | sort | reverse %}
  {% for item in sorted_temp_tags %}
    {% assign parts = item | split:'#' %}
    {% assign count = parts[0] | plus: 0 %}
    {% if count > 0 and parts[1] != '' %}
      <li><a href="/tag/{{ parts[1] | slugify }}/">{{ parts[1] }} ({{ count }})</a></li>
    {% endif %}
  {% endfor %}
</ul>
</aside>

<!-- Main Container -->
<div class="container">
  <!-- Main Content Listing the Posts -->
  <div class="main-content" id="post-list">
    {% for post in paginator.posts %}
    <div class="article">
      <h2><a href="{{ post.url | relative_url }}">{{ post.title }}</a></h2>
      {% if post.image %}
        <img src="{{ post.image }}" alt="{{ post.title }}">
      {% endif %}
      <p>{{ post.excerpt }}</p>
      <p>
        Tags:
        {% for tag in post.tags %}
          <a href="/tag/{{ tag | slugify }}/">{{ tag }}</a>{% unless forloop.last %}, {% endunless %}
        {% endfor %}
      </p>
      <a href="{{ post.url | relative_url }}">Read more...</a>
    </div>
    {% endfor %}
  </div>

  <!-- Sidebar with Featured Video -->
  <aside class="sidebar">
    <h3>Featured Video</h3>
    <div class="video-container">
      <iframe width="560" height="315" src="https://www.youtube.com/embed/13_aCZ0s-E4?si=kUgd9AW2I3UiuWbC" allowfullscreen></iframe>
    </div>
    <div class="video-container">
      <iframe width="560" height="315" src="https://www.youtube.com/embed/ryZqFhj_Quc?si=jm9J1Z7BRyY4Vjay" allowfullscreen></iframe>
    </div>
  </aside>
</div>

<!-- Pagination Controls -->
<div class="pagination">
  {% if paginator.previous_page %}
    <a class="previous" href="{{ paginator.previous_page_path | relative_url }}">&laquo; Previous</a>
  {% else %}
    <span class="disabled">&laquo; Previous</span>
  {% endif %}

  {% for page_num in (1..paginator.total_pages) %}
    {% if page_num == paginator.page %}
      <span class="current">{{ page_num }}</span>
    {% else %}
      <a href="{{ paginator.paginate_path | relative_url | replace:'PAGE', page_num }}">{{ page_num }}</a>
    {% endif %}
  {% endfor %}

  {% if paginator.next_page %}
    <a class="next" href="{{ paginator.next_page_path | relative_url }}">Next &raquo;</a>
  {% else %}
    <span class="disabled">Next &raquo;</span>
  {% endif %}
</div>

<!-- Footer -->
<footer style="text-align: center; font-size: 0.9rem; color: #888; margin-top: 3rem;">
  <p>
    <a href="/privacy_policy.html">Privacy Policy</a> &nbsp;|&nbsp;
    &copy; 2025 GUNC. All Rights Reserved.
  </p>
</footer>

<!-- Fuse.js Search Script -->
<script src="https://cdn.jsdelivr.net/npm/fuse.js@7.0.0"></script>
<script>
  const searchBox = document.getElementById('search-box');
  const postList = document.getElementById('post-list');
  let allPosts = [];

  fetch('{{ "/search.json" | relative_url }}')
    .then(response => response.json())
    .then(data => {
      allPosts = data;
    });

  searchBox.addEventListener('input', function () {
    const query = this.value.trim();
    if (!query) {
      location.reload(); // fallback to paginated view
      return;
    }

    const fuse = new Fuse(allPosts, {
      keys: ['title', 'excerpt', 'tags'],
      threshold: 0.3
    });

    const results = fuse.search(query).map(result => result.item);
    renderSearchResults(results);
  });

  function renderSearchResults(results) {
    postList.innerHTML = results.map(post => `
      <div class="article">
        <h2><a href="${post.url}">${post.title}</a></h2>
        <p>${post.excerpt}</p>
        <p>
          Tags: ${post.tags.map(tag => `<a href="/tag/${tag.slug}/">${tag.name}</a>`).join(', ')}
        </p>
        <a href="${post.url}">Read more...</a>
      </div>
    `).join('');
  }
</script>

<!-- Lunr.js Search Script -->
  <!-- Lunr.js Search Script -->
<script src="https://unpkg.com/lunr@2.3.9/lunr.js"></script>
<script>
  let index; // Lunr index
  let documents; // Full docs

  // Load index on page load
  fetch('/search.json')
    .then(response => response.json())
    .then(data => {
      documents = data;
      index = lunr(function () {
        this.ref('url');
        this.field('title', { boost: 10 });
        this.field('excerpt');
        this.field('content');
        this.field('tags', { boost: 5 });

        data.forEach(doc => this.add(doc));
      });
    })
    .catch(error => console.error('Error loading search index:', error));

  // Handle search
  document.getElementById('search-form').addEventListener('submit', function (e) {
    e.preventDefault();
    const query = document.getElementById('search-input').value.trim();
    const postList = document.getElementById('post-list');
    const pagination = document.querySelector('.pagination');

    if (!query) {
      location.reload(); // Reset to default paginated view if empty
      return;
    }

    if (!index) return;

    const results = index.search(query + '* ~1'); // Wildcard + fuzzy (tolerance 1)
    postList.innerHTML = ''; // Clear default posts

    if (results.length === 0) {
      postList.innerHTML = '<p>No results found.</p>';
    } else {
      results.forEach(result => {
        const doc = documents.find(d => d.url === result.ref);
        const resultHTML = `
          <div class="article">
            <h2><a href="${doc.url}">${doc.title}</a></h2>
            <p>${doc.excerpt}</p>
            <p>Tags: ${doc.tags.map(tag => `<a href="/tag/${tag.toLowerCase().replace(/\s+/g, '-')}">${tag}</a>`).join(', ')}</p>
            <a href="${doc.url}">Read more...</a>
          </div>
        `;
        postList.innerHTML += resultHTML;
      });
    }

    // Hide pagination for search results
    pagination.style.display = 'none';
  });
</script>